<html><head><meta charset="utf-8"></meta><meta name="viewport" content="width=device-width, initial-scale=1"></meta><title>Optional Braces</title><link rel="shortcut icon" type="image/x-icon" href="../../../favicon.ico"></link><script type="text/javascript" src="../../../scripts/clipboard.js" defer="true"></script><script type="text/javascript" src="../../../scripts/platform-content-handler.js" defer="true"></script><script type="text/javascript" src="../../../scripts/main.js" defer="true"></script><link rel="stylesheet" href="../../../styles/nord-light.css"></link><link rel="stylesheet" href="../../../styles/scalastyle.css"></link><link rel="stylesheet" href="../../../styles/dotty-icons.css"></link><link rel="stylesheet" href="../../../styles/diagram.css"></link><link rel="stylesheet" href="../../../styles/filter-bar.css"></link><link rel="stylesheet" href="../../../styles/search-bar.css"></link><script type="text/javascript" src="https://code.jquery.com/jquery-3.5.1.min.js" defer="true"></script><script type="text/javascript" src="https://d3js.org/d3.v6.min.js" defer="true"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/graphlib-dot@0.6.2/dist/graphlib-dot.min.js" defer="true"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/dagre-d3/0.6.1/dagre-d3.min.js" defer="true"></script><link rel="stylesheet" href="../../../styles/filter-bar.css"></link><script type="text/javascript" src="../../../hljs/highlight.pack.js" defer="true"></script><script type="text/javascript" src="../../../scripts/hljs-scala3.js" defer="true"></script><script type="text/javascript" src="../../../scripts/ux.js" defer="true"></script><script type="text/javascript" src="../../../scripts/common/component.js" defer="true"></script><script type="text/javascript" src="../../../scripts/common/utils.js" defer="true"></script><script type="text/javascript" src="../../../scripts/components/FilterBar.js" defer="true"></script><script type="text/javascript" src="../../../scripts/components/DocumentableList.js" defer="true"></script><script type="text/javascript" src="../../../scripts/components/Input.js" defer="true"></script><script type="text/javascript" src="../../../scripts/components/FilterGroup.js" defer="true"></script><script type="text/javascript" src="../../../scripts/components/Filter.js" defer="true"></script><script type="text/javascript" src="../../../scripts/data.js" defer="true"></script><link rel="stylesheet" href="../../../css/bootstrap.min.css"></link><link rel="stylesheet" href="../../../css/dottydoc.css"></link><link rel="stylesheet" href="../../../css/color-brewer.css"></link><script type="text/javascript" src="../../../js/jquery.min.js" defer="true"></script><script type="text/javascript" src="../../../js/bootstrap.min.js" defer="true"></script><script>var pathToRoot = "../../../";</script></head><body><div id="container"><div id="leftColumn"><div id="logo"><span><img src="../../../project-logo/logo.svg"></img></span><span><div class="projectName">Scala 3</div></span><span><div class="projectVersion">3.0.0-RC1-bin-20210108-a42fe92-NIGHTLY</div></span></div><div id="paneSearch"></div><nav id="sideMenu2"><div class="expanded"><a href="../../../index.html">Scala 3</a><span></span><div><a href="../../../blog/index.html">Blog</a><span></span><div><a href="../../../blog/2020/12/18/scala3-m3.html">Scala 3.0.0-M3: developer&apos;s preview before RC1</a></div><div><a href="../../../blog/2020/11/09/scala3-m1.html">Scala 3.0.0-M1 is here</a></div><div><a href="../../../blog/2020/09/21/naming-schema-change.html">Dotty becomes Scala 3</a></div><div><a href="../../../blog/2020/08/31/27th-dotty-milestone-release.html">Announcing Dotty 0.27.0-RC1 - ScalaJS, performance, stability</a></div><div><a href="../../../blog/2020/07/27/26th-dotty-milestone-release.html">Announcing Dotty 0.26.0-RC1 - unified extension methods and more</a></div><div><a href="../../../blog/2020/06/22/25th-dotty-milestone-release.html">Announcing Dotty 0.25.0-RC2 - speed-up of givens and change in the tuple API</a></div><div><a href="../../../blog/2020/04/29/24th-dotty-milestone-release.html">Announcing Dotty 0.24.0-RC1 - 2.13.2 standard library, better error messages and more</a></div><div><a href="../../../blog/2020/03/18/23rd-dotty-milestone-release.html">Announcing Dotty 0.23.0-RC1 - safe initialization checks, type-level bitwise operations and more</a></div><div><a href="../../../blog/2020/02/05/22nd-dotty-milestone-release.html">Announcing Dotty 0.22.0-RC1 - syntactic enhancements, type-level arithmetic and more</a></div><div><a href="../../../blog/2019/12/20/21th-dotty-milestone-release.html">Announcing Dotty 0.21.0-RC1 - explicit nulls, new syntax for `match` and conditional givens, and more</a></div><div><a href="../../../blog/2019/11/04/20th-dotty-milestone-release.html">Announcing Dotty 0.20.0-RC1 – `with` starting indentation blocks, inline given specializations and more</a></div><div><a href="../../../blog/2019/09/23/19th-dotty-milestone-release.html">Announcing Dotty 0.19.0-RC1 – further refinements of the syntax and the migration to 2.13.1 standard library</a></div><div><a href="../../../blog/2019/08/30/18th-dotty-milestone-release.html">Announcing Dotty 0.18.1-RC1 – switch to the 2.13 standard library, indentation-based syntax and other experiments</a></div><div><a href="../../../blog/2019/07/25/17th-dotty-milestone-release.html">Announcing Dotty 0.17.0-RC1 – new implicit scoping rules and more</a></div><div><a href="../../../blog/2019/06/11/16th-dotty-milestone-release.html">Announcing Dotty 0.16.0-RC3 – the Scala Days 2019 Release</a></div><div><a href="../../../blog/2019/05/23/15th-dotty-milestone-release.html">Announcing Dotty 0.15.0-RC1 – the fully bootstrapped compiler</a></div><div><a href="../../../blog/2019/04/15/14th-dotty-milestone-release.html">Announcing Dotty 0.14.0-RC1 with export, immutable arrays, creator applications and more</a></div><div><a href="../../../blog/2019/03/05/13th-dotty-milestone-release.html">Announcing Dotty 0.13.0-RC1 with Spark support, top level definitions and redesigned implicits</a></div><div><a href="../../../blog/2019/01/21/12th-dotty-milestone-release.html">Announcing Dotty 0.12.0-RC1</a></div><div><a href="../../../blog/2018/11/30/11th-dotty-milestone-release.html">Announcing Dotty 0.11.0-RC1</a></div><div><a href="../../../blog/2018/10/10/10th-dotty-milestone-release.html">Announcing Dotty 0.10.0-RC1</a></div><div><a href="../../../blog/2018/07/06/ninth-dotty-milestone-release.html">Announcing Dotty 0.9.0-RC1</a></div><div><a href="../../../blog/2018/04/27/eighth-dotty-milestone-release.html">Announcing Dotty 0.7.0 and 0.8.0-RC1</a></div><div><a href="../../../blog/2018/03/05/seventh-dotty-milestone-release.html">Announcing Dotty 0.6.0 and 0.7.0-RC1</a></div><div><a href="../../../blog/2017/12/01/fifth-dotty-milestone-release.html">Announcing Dotty 0.5.0-RC1</a></div><div><a href="../../../blog/2017/10/16/fourth-dotty-milestone-release.html">Announcing Dotty 0.4.0-RC1</a></div><div><a href="../../../blog/2017/09/07/third-dotty-milestone-release.html">Announcing Dotty 0.3.0-RC2</a></div><div><a href="../../../blog/2017/07/12/second-dotty-milestone-release.html">Announcing Dotty 0.2.0-RC1, with new optimizations, improved stability and IDE support</a></div><div><a href="../../../blog/2017/05/31/first-dotty-milestone-release.html">Announcing Dotty 0.1.2-RC1, a major step towards Scala 3</a></div><div><a href="../../../blog/2016/12/05/implicit-function-types.html">Implicit Function Types</a></div><div><a href="../../../blog/2016/05/05/multiversal-equality.html">Multiversal Equality for Scala</a></div><div><a href="../../../blog/2016/02/17/scaling-dot-soundness.html">Scaling DOT to Scala - Soundness</a></div><div><a href="../../../blog/2016/02/03/essence-of-scala.html">The Essence of Scala</a></div><div><a href="../../../blog/2016/01/02/new-year-resolutions.html">New Year Resolutions</a></div><div><a href="../../../blog/2015/10/23/dotty-compiler-bootstraps.html">We got liftoff!</a></div></div><div><a href="../../Usage/index.html">Usage</a><span></span><div><a href="../../usage/getting-started.html">Getting Started: Users</a></div><div><a href="../../usage/sbt-projects.html">Using Dotty with sbt</a></div><div><a href="../../usage/ide-support.html">IDE support for Dotty</a></div><div><a href="../../usage/worksheet-mode.html">Worksheet mode with Dotty IDE</a></div><div><a href="../../usage/language-versions.html">Language Versions</a></div><div><a href="../../usage/cbt-projects.html">Using Dotty with cbt</a></div><div><a href="../../usage/scala3doc/index.html">Scala3doc</a><span></span><div><a href="../../usage/scala3doc/blog.html">Built-in blog</a></div><div><a href="../../usage/scala3doc/specificTags.html">Scala3doc-specific Tags and Features</a></div><div><a href="../../usage/scala3doc/staticSite.html">Static documentation</a></div><div><a href="../../usage/scala3doc/docComments.html">API Documentation</a></div></div><div><a href="../../usage/dottydoc.html">Dottydoc [Legacy]</a></div></div><div class="expanded"><a href="../../Reference/index.html">Reference</a><span></span><div><a href="../overview.html">Overview</a></div><div><a href="../../New Types/index.html">New Types</a><span></span><div><a href="../new-types/intersection-types.html">Intersection Types</a></div><div><a href="../new-types/union-types.html">Union Types</a></div><div><a href="../new-types/type-lambdas.html">Type Lambdas</a></div><div><a href="../new-types/match-types.html">Match Types</a></div><div><a href="../new-types/dependent-function-types.html">Dependent Function Types</a></div><div><a href="../new-types/polymorphic-function-types.html">Polymorphic Function Types</a></div></div><div><a href="../../Enums/index.html">Enums</a><span></span><div><a href="../enums/enums.html">Enumerations</a></div><div><a href="../enums/adts.html">Algebraic Data Types</a></div><div><a href="../enums/desugarEnums.html">Translation of Enums and ADTs</a></div></div><div><a href="../../Contextual Abstractions/index.html">Contextual Abstractions</a><span></span><div><a href="../contextual/motivation.html">Overview</a></div><div><a href="../contextual/givens.html">Given Instances</a></div><div><a href="../contextual/using-clauses.html">Using Clauses</a></div><div><a href="../contextual/context-bounds.html">Context Bounds</a></div><div><a href="../contextual/given-imports.html">Importing Givens</a></div><div><a href="../contextual/extension-methods.html">Extension Methods</a></div><div><a href="../contextual/type-classes.html">Implementing Type classes</a></div><div><a href="../contextual/derivation.html">Type Class Derivation</a></div><div><a href="../contextual/multiversal-equality.html">Multiversal Equality</a></div><div><a href="../contextual/context-functions.html">Context Functions</a></div><div><a href="../contextual/conversions.html">Implicit Conversions</a></div><div><a href="../contextual/by-name-context-parameters.html">By-Name Context Parameters</a></div><div><a href="../contextual/relationship-implicits.html">Relationship with Scala 2 Implicits</a></div></div><div><a href="../../Metaprogramming/index.html">Metaprogramming</a><span></span><div><a href="../metaprogramming/toc.html">Overview</a></div><div><a href="../metaprogramming/inline.html">Inline</a></div><div><a href="../metaprogramming/macros.html">Macros</a></div><div><a href="../metaprogramming/staging.html">Multi-Stage Programming</a></div><div><a href="../metaprogramming/tasty-reflect.html">TASTy Reflect</a></div><div><a href="../metaprogramming/tasty-inspect.html">TASTy Inspection</a></div></div><div class="expanded"><a href="../../Other New Features/index.html">Other New Features</a><span></span><div><a href="trait-parameters.html">Trait Parameters</a></div><div><a href="transparent-traits.html">Transparent Traits</a></div><div><a href="creator-applications.html">Universal Apply Methods</a></div><div><a href="export.html">Export Clauses</a></div><div><a href="opaques.html">Opaque Type Aliases</a></div><div><a href="open-classes.html">Open Classes</a></div><div><a href="parameter-untupling.html">Parameter Untupling</a></div><div><a href="kind-polymorphism.html">Kind Polymorphism</a></div><div><a href="matchable.html">The Matchable Trait</a></div><div><a href="threadUnsafe-annotation.html">The @threadUnsafe annotation</a></div><div><a href="targetName.html">The @targetName annotation</a></div><div><a href="control-syntax.html">New Control Syntax</a></div><div><a href="" class="selected expanded">Optional Braces</a></div><div><a href="explicit-nulls.html">Explicit Nulls</a></div><div><a href="safe-initialization.html">Safe Initialization</a></div></div><div><a href="../../Other Changed Features/index.html">Other Changed Features</a><span></span><div><a href="../changed-features/numeric-literals.html">Numeric Literals</a></div><div><a href="../changed-features/structural-types.html">Programmatic Structural Types</a></div><div><a href="../changed-features/operators.html">Rules for Operators</a></div><div><a href="../changed-features/wildcards.html">Wildcard Arguments in Types</a></div><div><a href="../changed-features/type-checking.html">Changes in Type Checking</a></div><div><a href="../changed-features/type-inference.html">Changes in Type Inference</a></div><div><a href="../changed-features/implicit-resolution.html">Changes in Implicit Resolution</a></div><div><a href="../changed-features/implicit-conversions.html">Implicit Conversions</a></div><div><a href="../changed-features/overload-resolution.html">Changes in Overload Resolution</a></div><div><a href="../changed-features/match-syntax.html">Match Expressions</a></div><div><a href="../changed-features/vararg-patterns.html">Vararg Patterns</a></div><div><a href="../changed-features/pattern-bindings.html">Pattern Bindings</a></div><div><a href="../changed-features/pattern-matching.html">Option-less pattern matching</a></div><div><a href="../changed-features/eta-expansion.html">Automatic Eta Expansion</a></div><div><a href="../changed-features/compiler-plugins.html">Changes in Compiler Plugins</a></div><div><a href="../changed-features/lazy-vals-init.html">Lazy Vals initialization</a></div><div><a href="../changed-features/main-functions.html">Main Methods</a></div></div><div><a href="../../Dropped Features/index.html">Dropped Features</a><span></span><div><a href="../dropped-features/delayed-init.html">Dropped: Delayedinit</a></div><div><a href="../dropped-features/macros.html">Dropped: Scala 2 Macros</a></div><div><a href="../dropped-features/existential-types.html">Dropped: Existential Types</a></div><div><a href="../dropped-features/type-projection.html">Dropped: General Type Projection</a></div><div><a href="../dropped-features/do-while.html">Dropped: Do-While</a></div><div><a href="../dropped-features/procedure-syntax.html">Dropped: Procedure Syntax</a></div><div><a href="../dropped-features/package-objects.html">Dropped: Package Objects</a></div><div><a href="../dropped-features/early-initializers.html">Dropped: Early Initializers</a></div><div><a href="../dropped-features/class-shadowing.html">Dropped: Class Shadowing</a></div><div><a href="../dropped-features/limit22.html">Dropped: Limit 22</a></div><div><a href="../dropped-features/xml.html">Dropped: XML Literals</a></div><div><a href="../dropped-features/symlits.html">Dropped: Symbol Literals</a></div><div><a href="../dropped-features/auto-apply.html">Dropped: Auto-Application</a></div><div><a href="../dropped-features/weak-conformance.html">Dropped: Weak Conformance</a></div><div><a href="../dropped-features/nonlocal-returns.html">Deprecated: Nonlocal Returns</a></div><div><a href="../dropped-features/this-qualifier.html">Dropped: private[this] and protected[this]</a></div></div><div><a href="../syntax.html">Scala 3 Syntax Summary</a></div></div><div><a href="../../Contributing/index.html">Contributing</a><span></span><div><a href="../../contributing/contribute-knowledge.html">Contributing Knowledge</a></div><div><a href="../../contributing/getting-started.html">Getting Started</a></div><div><a href="../../contributing/workflow.html">Workflow</a></div><div><a href="../../contributing/testing.html">Testing in Dotty</a></div><div><a href="../../contributing/debugging.html">Debugging Techniques</a></div><div><a href="../../IDEs and Tools/index.html">IDEs and Tools</a><span></span><div><a href="../../contributing/tools/mill.html">Basic Operations with Mill</a></div><div><a href="../../contributing/tools/scalafix.html">Working with Scalafix</a></div></div><div><a href="../../Procedures/index.html">Procedures</a><span></span><div><a href="../../contributing/procedures/release.html">Release Procedure</a></div><div><a href="../../contributing/procedures/vulpix.html">Test Vulpix Framework</a></div></div></div><div><a href="../../Internals/index.html">Internals</a><span></span><div><a href="../../internals/backend.html">Backend Internals</a></div><div><a href="../../internals/classpaths.html">Classpaths</a></div><div><a href="../../internals/core-data-structures.html">Core Data Structures</a></div><div><a href="../../internals/contexts.html">Contexts</a></div><div><a href="../../internals/dotc-scalac.html">Differences between Scalac and Dotty</a></div><div><a href="../../internals/higher-kinded-v2.html">Higher-Kinded Types in Dotty</a></div><div><a href="../../internals/overall-structure.html">Dotty Overall Structure</a></div><div><a href="../../internals/periods.html">Dotc&apos;s concept of time</a></div><div><a href="../../internals/syntax.html">Scala 3 Syntax Summary</a></div><div><a href="../../internals/type-system.html">Type System</a></div><div><a href="../../internals/dotty-internals-1-notes.html">Dotty Internals 1: Trees &amp; Symbols (Meeting Notes)</a></div><div><a href="../../internals/debug-macros.html">Debug Macros</a></div></div><div><a href="../../Resources/index.html">Resources</a><span></span><div><a href="../../resources/talks.html">Talks</a></div></div><div><a href="../../../api/index.html">API</a><span></span><div><a href="../../../api/dotty/tools/tasty.html">dotty.tools.tasty</a></div><div><a href="../../../api/dotty/tools/tasty/util.html">dotty.tools.tasty.util</a></div><div><a href="../../../api/scala.html">scala</a></div><div><a href="../../../api/scala/annotation.html">scala.annotation</a></div><div><a href="../../../api/scala/annotation/meta.html">scala.annotation.meta</a></div><div><a href="../../../api/scala/annotation/unchecked.html">scala.annotation.unchecked</a></div><div><a href="../../../api/scala/beans.html">scala.beans</a></div><div><a href="../../../api/scala/collection.html">scala.collection</a></div><div><a href="../../../api/scala/collection/concurrent.html">scala.collection.concurrent</a></div><div><a href="../../../api/scala/collection/convert.html">scala.collection.convert</a></div><div><a href="../../../api/scala/collection/generic.html">scala.collection.generic</a></div><div><a href="../../../api/scala/collection/immutable.html">scala.collection.immutable</a></div><div><a href="../../../api/scala/collection/mutable.html">scala.collection.mutable</a></div><div><a href="../../../api/scala/compat.html">scala.compat</a></div><div><a href="../../../api/scala/compiletime.html">scala.compiletime</a></div><div><a href="../../../api/scala/compiletime/ops.html">scala.compiletime.ops</a></div><div><a href="../../../api/scala/compiletime/testing.html">scala.compiletime.testing</a></div><div><a href="../../../api/scala/concurrent.html">scala.concurrent</a></div><div><a href="../../../api/scala/concurrent/duration.html">scala.concurrent.duration</a></div><div><a href="../../../api/scala/deriving.html">scala.deriving</a></div><div><a href="../../../api/scala/io.html">scala.io</a></div><div><a href="../../../api/scala/jdk.html">scala.jdk</a></div><div><a href="../../../api/scala/jdk/javaapi.html">scala.jdk.javaapi</a></div><div><a href="../../../api/scala/math.html">scala.math</a></div><div><a href="../../../api/scala/quoted.html">scala.quoted</a></div><div><a href="../../../api/scala/quoted/runtime.html">scala.quoted.runtime</a></div><div><a href="../../../api/scala/ref.html">scala.ref</a></div><div><a href="../../../api/scala/reflect.html">scala.reflect</a></div><div><a href="../../../api/scala/reflect/macros.html">scala.reflect.macros</a></div><div><a href="../../../api/scala/runtime.html">scala.runtime</a></div><div><a href="../../../api/scala/runtime/java8.html">scala.runtime.java8</a></div><div><a href="../../../api/scala/sys.html">scala.sys</a></div><div><a href="../../../api/scala/sys/process.html">scala.sys.process</a></div><div><a href="../../../api/scala/util.html">scala.util</a></div><div><a href="../../../api/scala/util/control.html">scala.util.control</a></div><div><a href="../../../api/scala/util/hashing.html">scala.util.hashing</a></div><div><a href="../../../api/scala/util/matching.html">scala.util.matching</a></div></div></div></nav></div><div id="main"><div id="leftToggler"><span class="icon-toggler"></span></div><div id="searchBar"></div><main>
  <div id="content" pageIds="docs.reference.other-new-features.indentation.md////PointingToDeclaration//2049806133">
    <div class="breadcrumbs"><a href="../../index.html">Scala 3</a>/<a href="../../Reference/index.html">Reference</a>/<a href="../../Other New Features/index.html">Other New Features</a>/<a href="">Optional Braces</a></div>
<html>
 <head>
  <link rel="dns-prefetch" href="//fonts.googleapis.com"> 
  <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin> 
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin> 
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.9.0/css/all.min.css"> 
 </head>
 <body>
  <div id="content-wrapper"> 
   <main class="container"> 
    <header> 
     <h1>Optional Braces</h1> 
     <div class="byline"> <a href="https://github.com/lampepfl/dotty/edit/master/docs/docs/reference/other-new-features/indentation.md"> <i class="far fa-edit"></i> Edit this page on GitHub </a> 
     </div> 
    </header> 
    <p>As an experimental feature, Scala 3 enforces some rules on indentation and allows some occurrences of braces <code>{...}</code> to be optional. It can be turned off with the compiler flag <code>-noindent</code>.</p> 
    <ul> 
     <li>First, some badly indented programs are flagged with warnings.</li> 
     <li>Second, some occurrences of braces <code>{...}</code> are made optional. Generally, the rule is that adding a pair of optional braces will not change the meaning of a well-indented program.</li> 
    </ul> 
    <h3><a href="#indentation-rules" id="indentation-rules" class="anchor"></a>Indentation Rules</h3> 
    <p>The compiler enforces two rules for well-indented programs, flagging violations as warnings.</p> 
    <ol> 
     <li> <p>In a brace-delimited region, no statement is allowed to start to the left of the first statement after the opening brace that starts a new line.</p> <p>This rule is helpful for finding missing closing braces. It prevents errors like:</p> <pre><code class="language-scala">if (x &lt; 0) {
  println(1)
  println(2)

println("done")  // error: indented too far to the left
</code></pre> </li> 
     <li> <p>If significant indentation is turned off (i.e. under Scala 2 mode or under <code>-noindent</code>) and we are at the start of an indented sub-part of an expression, and the indented part ends in a newline, the next statement must start at an indentation width less than the sub-part. This prevents errors where an opening brace was forgotten, as in</p> <pre><code class="language-scala">if (x &lt; 0)
  println(1)
  println(2)   // error: missing `{`
</code></pre> </li> 
    </ol> 
    <p>These rules still leave a lot of leeway how programs should be indented. For instance, they do not impose any restrictions on indentation within expressions, nor do they require that all statements of an indentation block line up exactly.</p> 
    <p>The rules are generally helpful in pinpointing the root cause of errors related to missing opening or closing braces. These errors are often quite hard to diagnose, in particular in large programs.</p> 
    <h3><a href="#optional-braces" id="optional-braces" class="anchor"></a>Optional Braces</h3> 
    <p>The compiler will insert <code>&lt;indent&gt;</code> or <code>&lt;outdent&gt;</code> tokens at certain line breaks. Grammatically, pairs of <code>&lt;indent&gt;</code> and <code>&lt;outdent&gt;</code> tokens have the same effect as pairs of braces <code>{</code> and <code>}</code>.</p> 
    <p>The algorithm makes use of a stack <code>IW</code> of previously encountered indentation widths. The stack initially holds a single element with a zero indentation width. The <em>current indentation width</em> is the indentation width of the top of the stack.</p> 
    <p>There are two rules:</p> 
    <ol> 
     <li> <p>An <code>&lt;indent&gt;</code> is inserted at a line break, if</p> 
      <ul> 
       <li>An indentation region can start at the current position in the source, and</li> 
       <li>the first token on the next line has an indentation width strictly greater than the current indentation width</li> 
      </ul> <p>An indentation region can start</p> 
      <ul> 
       <li>after the leading parameters of an <code>extension</code>, or</li> 
       <li>after a <code>with</code> in a given instance, or</li> 
       <li>after a ": at end of line" token (see below)</li> 
       <li> <p>after one of the following tokens:</p> <pre><code>=  =&gt;  ?=&gt;  &lt;-  catch  do  else  finally  for
if  match  return  then  throw  try  while  yield
</code></pre> </li> 
      </ul> <p>If an <code>&lt;indent&gt;</code> is inserted, the indentation width of the token on the next line is pushed onto <code>IW</code>, which makes it the new current indentation width.</p> </li> 
     <li> <p>An <code>&lt;outdent&gt;</code> is inserted at a line break, if</p> 
      <ul> 
       <li>the first token on the next line has an indentation width strictly less than the current indentation width, and</li> 
       <li>the last token on the previous line is not one of the following tokens which indicate that the previous statement continues: <pre><code>then  else  do  catch  finally  yield  match
</code></pre> </li> 
       <li>the first token on the next line is not a <a href="../changed-features/operators.html">leading infix operator</a>.</li> 
      </ul> <p>If an <code>&lt;outdent&gt;</code> is inserted, the top element is popped from <code>IW</code>. If the indentation width of the token on the next line is still less than the new current indentation width, step (2) repeats. Therefore, several <code>&lt;outdent&gt;</code> tokens may be inserted in a row.</p> <p>An <code>&lt;outdent&gt;</code> is also inserted if the next token following a statement sequence starting with an <code>&lt;indent&gt;</code> closes an indentation region, i.e. is one of <code>then</code>, <code>else</code>, <code>do</code>, <code>catch</code>, <code>finally</code>, <code>yield</code>, <code>}</code>, <code>)</code>, <code>]</code> or <code>case</code>.</p> <p>An <code>&lt;outdent&gt;</code> is finally inserted in front of a comma that follows a statement sequence starting with an <code>&lt;indent&gt;</code> if the indented region is itself enclosed in parentheses</p> </li> 
    </ol> 
    <p>It is an error if the indentation width of the token following an <code>&lt;outdent&gt;</code> does not match the indentation of some previous line in the enclosing indentation region. For instance, the following would be rejected.</p> 
    <pre><code class="language-scala">if x &lt; 0 then
     -x
  else   // error: `else` does not align correctly
     x
</code></pre> 
    <p>Indentation tokens are only inserted in regions where newline statement separators are also inferred: at the top-level, inside braces <code>{...}</code>, but not inside parentheses <code>(...)</code>, patterns or types.</p> 
    <h3><a href="#optional-braces-around-template-bodies" id="optional-braces-around-template-bodies" class="anchor"></a>Optional Braces Around Template Bodies</h3> 
    <p>The Scala grammar uses the term <em>template body</em> for the definitions of a class, trait, or object that are normally enclosed in braces. The braces around a template body can also be omitted by means of the following rule</p> 
    <p>If at the point where a template body can start there is a <code>:</code> that occurs at the end of a line, and that is followed by at least one indented statement, the recognized token is changed from ":" to ": at end of line". The latter token is one of the tokens that can start an indentation region. The Scala grammar is changed so an optional ": at end of line" is allowed in front of a template body.</p> 
    <p>Analogous rules apply for enum bodies and local packages containing nested definitions.</p> 
    <p>With these new rules, the following constructs are all valid:</p> 
    <pre><code class="language-scala">trait A:
   def f: Int

class C(x: Int) extends A:
   def f = x

object O:
   def f = 3

enum Color:
   case Red, Green, Blue

new A:
   def f = 3

package p:
   def a = 1

package q:
   def b = 2
</code></pre> 
    <p>In each case, the <code>:</code> at the end of line can be replaced without change of meaning by a pair of braces that enclose the following indented definition(s).</p> 
    <p>The syntax changes allowing this are as follows:</p> 
    <pre><code>Template    ::=  InheritClauses [colonEol] [TemplateBody]
EnumDef     ::=  id ClassConstr InheritClauses [colonEol] EnumBody
Packaging   ::=  ‘package’ QualId [nl | colonEol] ‘{’ TopStatSeq ‘}’
SimpleExpr  ::=  ‘new’ ConstrApp {‘with’ ConstrApp} [[colonEol] TemplateBody]
</code></pre> 
    <p>Here, <code>colonEol</code> stands for ": at end of line", as described above. The lexical analyzer is modified so that a <code>:</code> at the end of a line is reported as <code>colonEol</code> if the parser is at a point where a <code>colonEol</code> is valid as next token.</p> 
    <h3><a href="#spaces-vs-tabs" id="spaces-vs-tabs" class="anchor"></a>Spaces vs Tabs</h3> 
    <p>Indentation prefixes can consist of spaces and/or tabs. Indentation widths are the indentation prefixes themselves, ordered by the string prefix relation. So, so for instance "2 tabs, followed by 4 spaces" is strictly less than "2 tabs, followed by 5 spaces", but "2 tabs, followed by 4 spaces" is incomparable to "6 tabs" or to "4 spaces, followed by 2 tabs". It is an error if the indentation width of some line is incomparable with the indentation width of the region that's current at that point. To avoid such errors, it is a good idea not to mix spaces and tabs in the same source file.</p> 
    <h3><a href="#indentation-and-braces" id="indentation-and-braces" class="anchor"></a>Indentation and Braces</h3> 
    <p>Indentation can be mixed freely with braces <code>{...}</code>, as well as brackets <code>[...]</code> and parentheses <code>(...)</code>. For interpreting indentation inside such regions, the following rules apply.</p> 
    <ol> 
     <li> <p>The assumed indentation width of a multiline region enclosed in braces is the indentation width of the first token that starts a new line after the opening brace.</p> </li> 
     <li> <p>The assumed indentation width of a multiline region inside brackets or parentheses is:</p> 
      <ul> 
       <li>if the opening bracket or parenthesis is at the end of a line, the indentation width of token following it,</li> 
       <li>otherwise, the indentation width of the enclosing region.</li> 
      </ul> </li> 
     <li>On encountering a closing brace <code>}</code>, bracket <code>]</code> or parenthesis <code>)</code>, as many <code>&lt;outdent&gt;</code> tokens as necessary are inserted to close all open nested indentation regions.</li> 
    </ol> 
    <p>For instance, consider:</p> 
    <pre><code class="language-scala">{
   val x = f(x: Int, y =&gt;
      x * (
         y + 1
      ) +
      (x +
      x)
   )
}
</code></pre> 
    <ul> 
     <li>Here, the indentation width of the region enclosed by the braces is 3 (i.e. the indentation width of the statement starting with <code>val</code>).</li> 
     <li>The indentation width of the region in parentheses that follows <code>f</code> is also 3, since the opening parenthesis is not at the end of a line.</li> 
     <li>The indentation width of the region in parentheses around <code>y + 1</code> is 9 (i.e. the indentation width of <code>y + 1</code>).</li> 
     <li>Finally, the indentation width of the last region in parentheses starting with <code>(x</code> is 6 (i.e. the indentation width of the indented region following the <code>=&gt;</code>.</li> 
    </ul> 
    <h3><a href="#special-treatment-of-case-clauses" id="special-treatment-of-case-clauses" class="anchor"></a>Special Treatment of Case Clauses</h3> 
    <p>The indentation rules for <code>match</code> expressions and <code>catch</code> clauses are refined as follows:</p> 
    <ul> 
     <li>An indentation region is opened after a <code>match</code> or <code>catch</code> also if the following <code>case</code> appears at the indentation width that's current for the <code>match</code> itself.</li> 
     <li>In that case, the indentation region closes at the first token at that same indentation width that is not a <code>case</code>, or at any token with a smaller indentation width, whichever comes first.</li> 
    </ul> 
    <p>The rules allow to write <code>match</code> expressions where cases are not indented themselves, as in the example below:</p> 
    <pre><code class="language-scala">x match
   case 1 =&gt; print("I")
   case 2 =&gt; print("II")
   case 3 =&gt; print("III")
   case 4 =&gt; print("IV")
   case 5 =&gt; print("V")

println(".")
</code></pre> 
    <h3><a href="#the-end-marker" id="the-end-marker" class="anchor"></a>The End Marker</h3> 
    <p>Indentation-based syntax has many advantages over other conventions. But one possible problem is that it makes it hard to discern when a large indentation region ends, since there is no specific token that delineates the end. Braces are not much better since a brace by itself also contains no information about what region is closed.</p> 
    <p>To solve this problem, Scala 3 offers an optional <code>end</code> marker. Example:</p> 
    <pre><code class="language-scala">def largeMethod(...) =
   ...
   if ... then ...
   else
      ... // a large block
   end if
   ... // more code
end largeMethod
</code></pre> 
    <p>An <code>end</code> marker consists of the identifier <code>end</code> and a follow-on specifier token that together constitute all the tokes of a line. Possible specifier tokens are identifiers or one of the following keywords</p> 
    <pre><code class="language-scala">if   while    for    match    try    new    this    val   given
</code></pre> 
    <p>End markers are allowed in statement sequences. The specifier token <code>s</code> of an end marker must correspond to the statement that precedes it. This means:</p> 
    <ul> 
     <li>If the statement defines a member <code>x</code> then <code>s</code> must be the same identifier <code>x</code>.</li> 
     <li>If the statement defines a constructor then <code>s</code> must be <code>this</code>.</li> 
     <li>If the statement defines an anonymous given, then <code>s</code> must be <code>given</code>.</li> 
     <li>If the statement defines an anonymous extension, then <code>s</code> must be <code>extension</code>.</li> 
     <li>If the statement defines an anonymous class, then <code>s</code> must be <code>new</code>.</li> 
     <li>If the statement is a <code>val</code> definition binding a pattern, then <code>s</code> must be <code>val</code>.</li> 
     <li>If the statement is a package clause that refers to package <code>p</code>, then <code>s</code> must be the same identifier <code>p</code>.</li> 
     <li>If the statement is an <code>if</code>, <code>while</code>, <code>for</code>, <code>try</code>, or <code>match</code> statement, then <code>s</code> must be that same token.</li> 
    </ul> 
    <p>For instance, the following end markers are all legal:</p> 
    <pre><code class="language-scala">package p1.p2:

   abstract class C():

      def this(x: Int) =
         this()
         if x &gt; 0 then
            val a :: b =
               x :: Nil
            end val
            var y =
               x
            end y
            while y &gt; 0 do
               println(y)
               y -= 1
            end while
            try
               x match
                  case 0 =&gt; println("0")
                  case _ =&gt;
               end match
            finally
               println("done")
            end try
         end if
      end this

      def f: String
   end C

   object C:
      given C =
         new C:
            def f = "!"
            end f
         end new
      end given
   end C

   extension (x: C)
      def ff: String = x.f ++ x.f
   end extension

end p2
</code></pre> 
    <h4><a href="#when-to-use-end-markers" id="when-to-use-end-markers" class="anchor"></a>When to Use End Markers</h4> 
    <p>It is recommended that <code>end</code> markers are used for code where the extent of an indentation region is not immediately apparent "at a glance". People will have different preferences what this means, but one can nevertheless give some guidelines that stem from experience. An end marker makes sense if</p> 
    <ul> 
     <li>the construct contains blank lines, or</li> 
     <li>the construct is long, say 15-20 lines or more,</li> 
     <li>the construct ends heavily indented, say 4 indentation levels or more.</li> 
    </ul> 
    <p>If none of these criteria apply, it's often better to not use an end marker since the code will be just as clear and more concise. If there are several ending regions that satisfy one of the criteria above, we usually need an end marker only for the outermost closed region. So cascades of end markers as in the example above are usually better avoided.</p> 
    <h4><a href="#syntax" id="syntax" class="anchor"></a>Syntax</h4> 
    <pre><code>EndMarker         ::=  ‘end’ EndMarkerTag    -- when followed by EOL
EndMarkerTag      ::=  id | ‘if’ | ‘while’ | ‘for’ | ‘match’ | ‘try’
                    |  ‘new’ | ‘this’ | ‘given’ | ‘extension’ | ‘val’
BlockStat         ::=  ... | EndMarker
TemplateStat      ::=  ... | EndMarker
TopStat           ::=  ... | EndMarker
</code></pre> 
    <h3><a href="#example" id="example" class="anchor"></a>Example</h3> 
    <p>Here is a (somewhat meta-circular) example of code using indentation. It provides a concrete representation of indentation widths as defined above together with efficient operations for constructing and comparing indentation widths.</p> 
    <pre><code class="language-scala">enum IndentWidth:
   case Run(ch: Char, n: Int)
   case Conc(l: IndentWidth, r: Run)

   def &lt;= (that: IndentWidth): Boolean = this match
      case Run(ch1, n1) =&gt;
         that match
            case Run(ch2, n2) =&gt; n1 &lt;= n2 &amp;&amp; (ch1 == ch2 || n1 == 0)
            case Conc(l, r)   =&gt; this &lt;= l
      case Conc(l1, r1) =&gt;
         that match
            case Conc(l2, r2) =&gt; l1 == l2 &amp;&amp; r1 &lt;= r2
            case _            =&gt; false

   def &lt; (that: IndentWidth): Boolean =
      this &lt;= that &amp;&amp; !(that &lt;= this)

   override def toString: String =
      this match
      case Run(ch, n) =&gt;
         val kind = ch match
            case ' '  =&gt; "space"
            case '\t' =&gt; "tab"
            case _    =&gt; s"'$ch'-character"
         val suffix = if n == 1 then "" else "s"
         s"$n $kind$suffix"
      case Conc(l, r) =&gt;
         s"$l, $r"

object IndentWidth:
   private inline val MaxCached = 40

   private val spaces = IArray.tabulate(MaxCached + 1)(new Run(' ', _))
   private val tabs = IArray.tabulate(MaxCached + 1)(new Run('\t', _))

   def Run(ch: Char, n: Int): Run =
      if n &lt;= MaxCached &amp;&amp; ch == ' ' then
         spaces(n)
      else if n &lt;= MaxCached &amp;&amp; ch == '\t' then
         tabs(n)
      else
         new Run(ch, n)
   end Run

   val Zero = Run(' ', 0)
end IndentWidth
</code></pre> 
    <h3><a href="#settings-and-rewrites" id="settings-and-rewrites" class="anchor"></a>Settings and Rewrites</h3> 
    <p>Significant indentation is enabled by default. It can be turned off by giving any of the options <code>-noindent</code>, <code>old-syntax</code> and <code>language:Scala2</code>. If indentation is turned off, it is nevertheless checked that indentation conforms to the logical program structure as defined by braces. If that is not the case, the compiler issues a warning.</p> 
    <p>The Scala 3 compiler can rewrite source code to indented code and back. When invoked with options <code>-rewrite -indent</code> it will rewrite braces to indented regions where possible. When invoked with options <code>-rewrite -noindent</code> it will rewrite in the reverse direction, inserting braces for indentation regions. The <code>-indent</code> option only works on <a href="control-syntax.html">new-style syntax</a>. So to go from old-style syntax to new-style indented code one has to invoke the compiler twice, first with options <code>-rewrite -new-syntax</code>, then again with options <code>-rewrite -indent</code>. To go in the opposite direction, from indented code to old-style syntax, it's <code>-rewrite -noindent</code>, followed by <code>-rewrite -old-syntax</code>.</p> 
    <h3><a href="#variant-indentation-marker-" id="variant-indentation-marker-" class="anchor"></a>Variant: Indentation Marker <code>:</code></h3> 
    <p>Generally, the possible indentation regions coincide with those regions where braces <code>{...}</code> are also legal, no matter whether the braces enclose an expression or a set of definitions. There is one exception, though: Arguments to function can be enclosed in braces but they cannot be simply indented instead. Making indentation always significant for function arguments would be too restrictive and fragile.</p> 
    <p>To allow such arguments to be written without braces, a variant of the indentation scheme is implemented under option <code>-Yindent-colons</code>. This variant is more contentious and less stable than the rest of the significant indentation scheme. In this variant, a colon <code>:</code> at the end of a line is also one of the possible tokens that opens an indentation region. Examples:</p> 
    <pre><code class="language-scala">times(10):
   println("ah")
   println("ha")
</code></pre> 
    <p>or</p> 
    <pre><code class="language-scala">xs.map:
   x =&gt;
      val y = x - 1
      y * y
</code></pre> 
    <p>The colon is usable not only for lambdas and by-name parameters, but also even for ordinary parameters:</p> 
    <pre><code class="language-scala">credentials ++ :
   val file = Path.userHome / ".credentials"
   if file.exists
   then Seq(Credentials(file))
   else Seq()
</code></pre> 
    <p>How does this syntax variant work? Colons at the end of lines are their own token, distinct from normal <code>:</code>. The Scala grammar is changed so that colons at end of lines are accepted at all points where an opening brace enclosing an argument is legal. Special provisions are taken so that method result types can still use a colon on the end of a line, followed by the actual type on the next.</p> 
   </main> 
  </div> 
  <script>
  ((window.gitter = {}).chat = {}).options = {
    room: 'lampepfl/dotty'
  };
</script> 
  <script src="https://sidecar.gitter.im/dist/sidecar.v1.js" async defer></script>
 </body>
</html>  </div>
</main><footer><span class="go-to-top-icon"><a href="#container"><span class="icon-vertical_align_top"></span>&nbsp;Back to top</a></span>Generated by&nbsp;<a href="https://github.com/lampepfl/dotty/tree/master/scala3doc"><img src="../../../images/scala3doc_logo.svg" alt="Scala3doc" class="scala3doc_logo"></img></a></footer></div></div><script type="text/javascript" src="../../../scripts/pages.js"></script><script type="text/javascript" src="../../../scripts/main.js"></script></body></html>
