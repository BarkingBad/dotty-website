<html><head><meta charset="utf-8"></meta><meta name="viewport" content="width=device-width, initial-scale=1"></meta><title>Scaling DOT to Scala - Soundness</title><link rel="shortcut icon" type="image/x-icon" href="../../../../favicon.ico"></link><script type="text/javascript" src="../../../../scripts/clipboard.js" defer="true"></script><script type="text/javascript" src="../../../../scripts/platform-content-handler.js" defer="true"></script><script type="text/javascript" src="../../../../scripts/main.js" defer="true"></script><link rel="stylesheet" href="../../../../styles/nord-light.css"></link><link rel="stylesheet" href="../../../../styles/scalastyle.css"></link><link rel="stylesheet" href="../../../../styles/dotty-icons.css"></link><link rel="stylesheet" href="../../../../styles/diagram.css"></link><link rel="stylesheet" href="../../../../styles/filter-bar.css"></link><link rel="stylesheet" href="../../../../styles/search-bar.css"></link><script type="text/javascript" src="https://code.jquery.com/jquery-3.5.1.min.js" defer="true"></script><script type="text/javascript" src="https://d3js.org/d3.v6.min.js" defer="true"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/graphlib-dot@0.6.2/dist/graphlib-dot.min.js" defer="true"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/dagre-d3/0.6.1/dagre-d3.min.js" defer="true"></script><link rel="stylesheet" href="../../../../styles/filter-bar.css"></link><script type="text/javascript" src="../../../../hljs/highlight.pack.js" defer="true"></script><script type="text/javascript" src="../../../../scripts/hljs-scala3.js" defer="true"></script><script type="text/javascript" src="../../../../scripts/ux.js" defer="true"></script><script type="text/javascript" src="../../../../scripts/common/component.js" defer="true"></script><script type="text/javascript" src="../../../../scripts/common/utils.js" defer="true"></script><script type="text/javascript" src="../../../../scripts/components/FilterBar.js" defer="true"></script><script type="text/javascript" src="../../../../scripts/components/DocumentableList.js" defer="true"></script><script type="text/javascript" src="../../../../scripts/components/Input.js" defer="true"></script><script type="text/javascript" src="../../../../scripts/components/FilterGroup.js" defer="true"></script><script type="text/javascript" src="../../../../scripts/components/Filter.js" defer="true"></script><script type="text/javascript" src="../../../../scripts/data.js" defer="true"></script><link rel="stylesheet" href="../../../../css/bootstrap.min.css"></link><link rel="stylesheet" href="../../../../css/dottydoc.css"></link><link rel="stylesheet" href="../../../../css/color-brewer.css"></link><script type="text/javascript" src="../../../../js/jquery.min.js" defer="true"></script><script type="text/javascript" src="../../../../js/bootstrap.min.js" defer="true"></script><script>var pathToRoot = "../../../../";</script></head><body><div id="container"><div id="leftColumn"><div id="logo"><span><img src="../../../../project-logo/logo.svg"></img></span><span><div class="projectName">Scala 3</div></span><span><div class="projectVersion">3.0.0-RC1-bin-20210106-e39b79e-NIGHTLY</div></span></div><div id="paneSearch"></div><nav id="sideMenu2"><div class="expanded"><a href="../../../../index.html">Scala 3</a><span></span><div class="expanded"><a href="../../../index.html">Blog</a><span></span><div><a href="../../../2020/12/18/scala3-m3.html">Scala 3.0.0-M3: developer&apos;s preview before RC1</a></div><div><a href="../../../2020/11/09/scala3-m1.html">Scala 3.0.0-M1 is here</a></div><div><a href="../../../2020/09/21/naming-schema-change.html">Dotty becomes Scala 3</a></div><div><a href="../../../2020/08/31/27th-dotty-milestone-release.html">Announcing Dotty 0.27.0-RC1 - ScalaJS, performance, stability</a></div><div><a href="../../../2020/07/27/26th-dotty-milestone-release.html">Announcing Dotty 0.26.0-RC1 - unified extension methods and more</a></div><div><a href="../../../2020/06/22/25th-dotty-milestone-release.html">Announcing Dotty 0.25.0-RC2 - speed-up of givens and change in the tuple API</a></div><div><a href="../../../2020/04/29/24th-dotty-milestone-release.html">Announcing Dotty 0.24.0-RC1 - 2.13.2 standard library, better error messages and more</a></div><div><a href="../../../2020/03/18/23rd-dotty-milestone-release.html">Announcing Dotty 0.23.0-RC1 - safe initialization checks, type-level bitwise operations and more</a></div><div><a href="../../../2020/02/05/22nd-dotty-milestone-release.html">Announcing Dotty 0.22.0-RC1 - syntactic enhancements, type-level arithmetic and more</a></div><div><a href="../../../2019/12/20/21th-dotty-milestone-release.html">Announcing Dotty 0.21.0-RC1 - explicit nulls, new syntax for `match` and conditional givens, and more</a></div><div><a href="../../../2019/11/04/20th-dotty-milestone-release.html">Announcing Dotty 0.20.0-RC1 – `with` starting indentation blocks, inline given specializations and more</a></div><div><a href="../../../2019/09/23/19th-dotty-milestone-release.html">Announcing Dotty 0.19.0-RC1 – further refinements of the syntax and the migration to 2.13.1 standard library</a></div><div><a href="../../../2019/08/30/18th-dotty-milestone-release.html">Announcing Dotty 0.18.1-RC1 – switch to the 2.13 standard library, indentation-based syntax and other experiments</a></div><div><a href="../../../2019/07/25/17th-dotty-milestone-release.html">Announcing Dotty 0.17.0-RC1 – new implicit scoping rules and more</a></div><div><a href="../../../2019/06/11/16th-dotty-milestone-release.html">Announcing Dotty 0.16.0-RC3 – the Scala Days 2019 Release</a></div><div><a href="../../../2019/05/23/15th-dotty-milestone-release.html">Announcing Dotty 0.15.0-RC1 – the fully bootstrapped compiler</a></div><div><a href="../../../2019/04/15/14th-dotty-milestone-release.html">Announcing Dotty 0.14.0-RC1 with export, immutable arrays, creator applications and more</a></div><div><a href="../../../2019/03/05/13th-dotty-milestone-release.html">Announcing Dotty 0.13.0-RC1 with Spark support, top level definitions and redesigned implicits</a></div><div><a href="../../../2019/01/21/12th-dotty-milestone-release.html">Announcing Dotty 0.12.0-RC1</a></div><div><a href="../../../2018/11/30/11th-dotty-milestone-release.html">Announcing Dotty 0.11.0-RC1</a></div><div><a href="../../../2018/10/10/10th-dotty-milestone-release.html">Announcing Dotty 0.10.0-RC1</a></div><div><a href="../../../2018/07/06/ninth-dotty-milestone-release.html">Announcing Dotty 0.9.0-RC1</a></div><div><a href="../../../2018/04/27/eighth-dotty-milestone-release.html">Announcing Dotty 0.7.0 and 0.8.0-RC1</a></div><div><a href="../../../2018/03/05/seventh-dotty-milestone-release.html">Announcing Dotty 0.6.0 and 0.7.0-RC1</a></div><div><a href="../../../2017/12/01/fifth-dotty-milestone-release.html">Announcing Dotty 0.5.0-RC1</a></div><div><a href="../../../2017/10/16/fourth-dotty-milestone-release.html">Announcing Dotty 0.4.0-RC1</a></div><div><a href="../../../2017/09/07/third-dotty-milestone-release.html">Announcing Dotty 0.3.0-RC2</a></div><div><a href="../../../2017/07/12/second-dotty-milestone-release.html">Announcing Dotty 0.2.0-RC1, with new optimizations, improved stability and IDE support</a></div><div><a href="../../../2017/05/31/first-dotty-milestone-release.html">Announcing Dotty 0.1.2-RC1, a major step towards Scala 3</a></div><div><a href="../../12/05/implicit-function-types.html">Implicit Function Types</a></div><div><a href="../../05/05/multiversal-equality.html">Multiversal Equality for Scala</a></div><div><a href="" class="selected expanded">Scaling DOT to Scala - Soundness</a></div><div><a href="../03/essence-of-scala.html">The Essence of Scala</a></div><div><a href="../../01/02/new-year-resolutions.html">New Year Resolutions</a></div><div><a href="../../../2015/10/23/dotty-compiler-bootstraps.html">We got liftoff!</a></div></div><div><a href="../../../../docs/Usage/index.html">Usage</a><span></span><div><a href="../../../../docs/usage/getting-started.html">Getting Started: Users</a></div><div><a href="../../../../docs/usage/sbt-projects.html">Using Dotty with sbt</a></div><div><a href="../../../../docs/usage/ide-support.html">IDE support for Dotty</a></div><div><a href="../../../../docs/usage/worksheet-mode.html">Worksheet mode with Dotty IDE</a></div><div><a href="../../../../docs/usage/language-versions.html">Language Versions</a></div><div><a href="../../../../docs/usage/cbt-projects.html">Using Dotty with cbt</a></div><div><a href="../../../../docs/usage/scala3doc/index.html">Scala3doc</a><span></span><div><a href="../../../../docs/usage/scala3doc/blog.html">Built-in blog</a></div><div><a href="../../../../docs/usage/scala3doc/specificTags.html">Scala3doc-specific Tags and Features</a></div><div><a href="../../../../docs/usage/scala3doc/staticSite.html">Static documentation</a></div><div><a href="../../../../docs/usage/scala3doc/docComments.html">API Documentation</a></div></div><div><a href="../../../../docs/usage/dottydoc.html">Dottydoc [Legacy]</a></div></div><div><a href="../../../../docs/Reference/index.html">Reference</a><span></span><div><a href="../../../../docs/reference/overview.html">Overview</a></div><div><a href="../../../../docs/New Types/index.html">New Types</a><span></span><div><a href="../../../../docs/reference/new-types/intersection-types.html">Intersection Types</a></div><div><a href="../../../../docs/reference/new-types/union-types.html">Union Types</a></div><div><a href="../../../../docs/reference/new-types/type-lambdas.html">Type Lambdas</a></div><div><a href="../../../../docs/reference/new-types/match-types.html">Match Types</a></div><div><a href="../../../../docs/reference/new-types/dependent-function-types.html">Dependent Function Types</a></div><div><a href="../../../../docs/reference/new-types/polymorphic-function-types.html">Polymorphic Function Types</a></div></div><div><a href="../../../../docs/Enums/index.html">Enums</a><span></span><div><a href="../../../../docs/reference/enums/enums.html">Enumerations</a></div><div><a href="../../../../docs/reference/enums/adts.html">Algebraic Data Types</a></div><div><a href="../../../../docs/reference/enums/desugarEnums.html">Translation of Enums and ADTs</a></div></div><div><a href="../../../../docs/Contextual Abstractions/index.html">Contextual Abstractions</a><span></span><div><a href="../../../../docs/reference/contextual/motivation.html">Overview</a></div><div><a href="../../../../docs/reference/contextual/givens.html">Given Instances</a></div><div><a href="../../../../docs/reference/contextual/using-clauses.html">Using Clauses</a></div><div><a href="../../../../docs/reference/contextual/context-bounds.html">Context Bounds</a></div><div><a href="../../../../docs/reference/contextual/given-imports.html">Importing Givens</a></div><div><a href="../../../../docs/reference/contextual/extension-methods.html">Extension Methods</a></div><div><a href="../../../../docs/reference/contextual/type-classes.html">Implementing Type classes</a></div><div><a href="../../../../docs/reference/contextual/derivation.html">Type Class Derivation</a></div><div><a href="../../../../docs/reference/contextual/multiversal-equality.html">Multiversal Equality</a></div><div><a href="../../../../docs/reference/contextual/context-functions.html">Context Functions</a></div><div><a href="../../../../docs/reference/contextual/conversions.html">Implicit Conversions</a></div><div><a href="../../../../docs/reference/contextual/by-name-context-parameters.html">By-Name Context Parameters</a></div><div><a href="../../../../docs/reference/contextual/relationship-implicits.html">Relationship with Scala 2 Implicits</a></div></div><div><a href="../../../../docs/Metaprogramming/index.html">Metaprogramming</a><span></span><div><a href="../../../../docs/reference/metaprogramming/toc.html">Overview</a></div><div><a href="../../../../docs/reference/metaprogramming/inline.html">Inline</a></div><div><a href="../../../../docs/reference/metaprogramming/macros.html">Macros</a></div><div><a href="../../../../docs/reference/metaprogramming/staging.html">Multi-Stage Programming</a></div><div><a href="../../../../docs/reference/metaprogramming/tasty-reflect.html">TASTy Reflect</a></div><div><a href="../../../../docs/reference/metaprogramming/tasty-inspect.html">TASTy Inspection</a></div></div><div><a href="../../../../docs/Other New Features/index.html">Other New Features</a><span></span><div><a href="../../../../docs/reference/other-new-features/trait-parameters.html">Trait Parameters</a></div><div><a href="../../../../docs/reference/other-new-features/transparent-traits.html">Transparent Traits</a></div><div><a href="../../../../docs/reference/other-new-features/creator-applications.html">Universal Apply Methods</a></div><div><a href="../../../../docs/reference/other-new-features/export.html">Export Clauses</a></div><div><a href="../../../../docs/reference/other-new-features/opaques.html">Opaque Type Aliases</a></div><div><a href="../../../../docs/reference/other-new-features/open-classes.html">Open Classes</a></div><div><a href="../../../../docs/reference/other-new-features/parameter-untupling.html">Parameter Untupling</a></div><div><a href="../../../../docs/reference/other-new-features/kind-polymorphism.html">Kind Polymorphism</a></div><div><a href="../../../../docs/reference/other-new-features/matchable.html">The Matchable Trait</a></div><div><a href="../../../../docs/reference/other-new-features/threadUnsafe-annotation.html">threadUnsafe annotation</a></div><div><a href="../../../../docs/reference/other-new-features/targetName.html">The @targetName annotation</a></div><div><a href="../../../../docs/reference/other-new-features/control-syntax.html">New Control Syntax</a></div><div><a href="../../../../docs/reference/other-new-features/indentation.html">Optional Braces</a></div><div><a href="../../../../docs/reference/other-new-features/explicit-nulls.html">Explicit Nulls</a></div><div><a href="../../../../docs/reference/other-new-features/safe-initialization.html">Safe Initialization</a></div></div><div><a href="../../../../docs/Other Changed Features/index.html">Other Changed Features</a><span></span><div><a href="../../../../docs/reference/changed-features/numeric-literals.html">Numeric Literals</a></div><div><a href="../../../../docs/reference/changed-features/structural-types.html">Programmatic Structural Types</a></div><div><a href="../../../../docs/reference/changed-features/operators.html">Rules for Operators</a></div><div><a href="../../../../docs/reference/changed-features/wildcards.html">Wildcard Arguments in Types</a></div><div><a href="../../../../docs/reference/changed-features/type-checking.html">Changes in Type Checking</a></div><div><a href="../../../../docs/reference/changed-features/type-inference.html">Changes in Type Inference</a></div><div><a href="../../../../docs/reference/changed-features/implicit-resolution.html">Changes in Implicit Resolution</a></div><div><a href="../../../../docs/reference/changed-features/implicit-conversions.html">Implicit Conversions</a></div><div><a href="../../../../docs/reference/changed-features/overload-resolution.html">Changes in Overload Resolution</a></div><div><a href="../../../../docs/reference/changed-features/match-syntax.html">Match Expressions</a></div><div><a href="../../../../docs/reference/changed-features/vararg-patterns.html">Vararg Patterns</a></div><div><a href="../../../../docs/reference/changed-features/pattern-bindings.html">Pattern Bindings</a></div><div><a href="../../../../docs/reference/changed-features/pattern-matching.html">Option-less pattern matching</a></div><div><a href="../../../../docs/reference/changed-features/eta-expansion.html">Automatic Eta Expansion</a></div><div><a href="../../../../docs/reference/changed-features/compiler-plugins.html">Changes in Compiler Plugins</a></div><div><a href="../../../../docs/reference/changed-features/lazy-vals-init.html">Lazy Vals initialization</a></div><div><a href="../../../../docs/reference/changed-features/main-functions.html">Main Methods</a></div></div><div><a href="../../../../docs/Dropped Features/index.html">Dropped Features</a><span></span><div><a href="../../../../docs/reference/dropped-features/delayed-init.html">Dropped: Delayedinit</a></div><div><a href="../../../../docs/reference/dropped-features/macros.html">Dropped: Scala 2 Macros</a></div><div><a href="../../../../docs/reference/dropped-features/existential-types.html">Dropped: Existential Types</a></div><div><a href="../../../../docs/reference/dropped-features/type-projection.html">Dropped: General Type Projection</a></div><div><a href="../../../../docs/reference/dropped-features/do-while.html">Dropped: Do-While</a></div><div><a href="../../../../docs/reference/dropped-features/procedure-syntax.html">Dropped: Procedure Syntax</a></div><div><a href="../../../../docs/reference/dropped-features/package-objects.html">Dropped: Package Objects</a></div><div><a href="../../../../docs/reference/dropped-features/early-initializers.html">Dropped: Early Initializers</a></div><div><a href="../../../../docs/reference/dropped-features/class-shadowing.html">Dropped: Class Shadowing</a></div><div><a href="../../../../docs/reference/dropped-features/limit22.html">Dropped: Limit 22</a></div><div><a href="../../../../docs/reference/dropped-features/xml.html">Dropped: XML Literals</a></div><div><a href="../../../../docs/reference/dropped-features/symlits.html">Dropped: Symbol Literals</a></div><div><a href="../../../../docs/reference/dropped-features/auto-apply.html">Dropped: Auto-Application</a></div><div><a href="../../../../docs/reference/dropped-features/weak-conformance.html">Dropped: Weak Conformance</a></div><div><a href="../../../../docs/reference/dropped-features/nonlocal-returns.html">Deprecated: Nonlocal Returns</a></div><div><a href="../../../../docs/reference/dropped-features/this-qualifier.html">Dropped: private[this] and protected[this]</a></div></div><div><a href="../../../../docs/reference/syntax.html">Scala 3 Syntax Summary</a></div></div><div><a href="../../../../docs/Contributing/index.html">Contributing</a><span></span><div><a href="../../../../docs/contributing/contribute-knowledge.html">Contributing Knowledge</a></div><div><a href="../../../../docs/contributing/getting-started.html">Getting Started</a></div><div><a href="../../../../docs/contributing/workflow.html">Workflow</a></div><div><a href="../../../../docs/contributing/testing.html">Testing in Dotty</a></div><div><a href="../../../../docs/contributing/debugging.html">Debugging Techniques</a></div><div><a href="../../../../docs/IDEs and Tools/index.html">IDEs and Tools</a><span></span><div><a href="../../../../docs/contributing/tools/mill.html">Basic Operations with Mill</a></div><div><a href="../../../../docs/contributing/tools/scalafix.html">Working with Scalafix</a></div></div><div><a href="../../../../docs/Procedures/index.html">Procedures</a><span></span><div><a href="../../../../docs/contributing/procedures/release.html">Release Procedure</a></div><div><a href="../../../../docs/contributing/procedures/vulpix.html">Test Vulpix Framework</a></div></div></div><div><a href="../../../../docs/Internals/index.html">Internals</a><span></span><div><a href="../../../../docs/internals/backend.html">Backend Internals</a></div><div><a href="../../../../docs/internals/classpaths.html">Classpaths</a></div><div><a href="../../../../docs/internals/core-data-structures.html">Core Data Structures</a></div><div><a href="../../../../docs/internals/contexts.html">Contexts</a></div><div><a href="../../../../docs/internals/dotc-scalac.html">Differences between Scalac and Dotty</a></div><div><a href="../../../../docs/internals/higher-kinded-v2.html">Higher-Kinded Types in Dotty</a></div><div><a href="../../../../docs/internals/overall-structure.html">Dotty Overall Structure</a></div><div><a href="../../../../docs/internals/periods.html">Dotc&apos;s concept of time</a></div><div><a href="../../../../docs/internals/syntax.html">Scala 3 Syntax Summary</a></div><div><a href="../../../../docs/internals/type-system.html">Type System</a></div><div><a href="../../../../docs/internals/dotty-internals-1-notes.html">Dotty Internals 1: Trees &amp; Symbols (Meeting Notes)</a></div><div><a href="../../../../docs/internals/debug-macros.html">Debug Macros</a></div></div><div><a href="../../../../docs/Resources/index.html">Resources</a><span></span><div><a href="../../../../docs/resources/talks.html">Talks</a></div></div><div><a href="../../../../api/index.html">API</a><span></span><div><a href="../../../../api/dotty/tools/tasty.html">dotty.tools.tasty</a></div><div><a href="../../../../api/dotty/tools/tasty/util.html">dotty.tools.tasty.util</a></div><div><a href="../../../../api/scala.html">scala</a></div><div><a href="../../../../api/scala/annotation.html">scala.annotation</a></div><div><a href="../../../../api/scala/annotation/meta.html">scala.annotation.meta</a></div><div><a href="../../../../api/scala/annotation/unchecked.html">scala.annotation.unchecked</a></div><div><a href="../../../../api/scala/beans.html">scala.beans</a></div><div><a href="../../../../api/scala/collection.html">scala.collection</a></div><div><a href="../../../../api/scala/collection/concurrent.html">scala.collection.concurrent</a></div><div><a href="../../../../api/scala/collection/convert.html">scala.collection.convert</a></div><div><a href="../../../../api/scala/collection/generic.html">scala.collection.generic</a></div><div><a href="../../../../api/scala/collection/immutable.html">scala.collection.immutable</a></div><div><a href="../../../../api/scala/collection/mutable.html">scala.collection.mutable</a></div><div><a href="../../../../api/scala/compat.html">scala.compat</a></div><div><a href="../../../../api/scala/compiletime.html">scala.compiletime</a></div><div><a href="../../../../api/scala/compiletime/ops.html">scala.compiletime.ops</a></div><div><a href="../../../../api/scala/compiletime/testing.html">scala.compiletime.testing</a></div><div><a href="../../../../api/scala/concurrent.html">scala.concurrent</a></div><div><a href="../../../../api/scala/concurrent/duration.html">scala.concurrent.duration</a></div><div><a href="../../../../api/scala/deriving.html">scala.deriving</a></div><div><a href="../../../../api/scala/io.html">scala.io</a></div><div><a href="../../../../api/scala/jdk.html">scala.jdk</a></div><div><a href="../../../../api/scala/jdk/javaapi.html">scala.jdk.javaapi</a></div><div><a href="../../../../api/scala/math.html">scala.math</a></div><div><a href="../../../../api/scala/quoted.html">scala.quoted</a></div><div><a href="../../../../api/scala/quoted/runtime.html">scala.quoted.runtime</a></div><div><a href="../../../../api/scala/ref.html">scala.ref</a></div><div><a href="../../../../api/scala/reflect.html">scala.reflect</a></div><div><a href="../../../../api/scala/reflect/macros.html">scala.reflect.macros</a></div><div><a href="../../../../api/scala/runtime.html">scala.runtime</a></div><div><a href="../../../../api/scala/runtime/java8.html">scala.runtime.java8</a></div><div><a href="../../../../api/scala/sys.html">scala.sys</a></div><div><a href="../../../../api/scala/sys/process.html">scala.sys.process</a></div><div><a href="../../../../api/scala/util.html">scala.util</a></div><div><a href="../../../../api/scala/util/control.html">scala.util.control</a></div><div><a href="../../../../api/scala/util/hashing.html">scala.util.hashing</a></div><div><a href="../../../../api/scala/util/matching.html">scala.util.matching</a></div></div></div></nav></div><div id="main"><div id="leftToggler"><span class="icon-toggler"></span></div><div id="searchBar"></div><main>
  <div id="content" pageIds="blog._posts.2016-02-17-scaling-dot-soundness.md////PointingToDeclaration//2049806133">
    <div class="breadcrumbs"><a href="../../../../docs/index.html">Scala 3</a>/<a href="../../../index.html">Blog</a>/<a href="">Scaling DOT to Scala - Soundness</a></div>
<html>
 <head>
  <link rel="dns-prefetch" href="//fonts.googleapis.com"> 
  <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin> 
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin> 
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.9.0/css/all.min.css"> 
 </head>
 <body>
  <div id="content-wrapper"> 
   <main class="container"> 
    <header> 
     <h1>Scaling DOT to Scala - Soundness</h1> 
     <div class="byline"> <time class="date"> <i class="far fa-calendar-alt"></i> 2016-02-17 </time> <span class="author"> <i class="fas fa-pen-nib"></i> Martin Odersky </span> 
     </div> 
    </header> 
    <p>In my <a href="http://www.scala-lang.org/blog/2016/02/03/essence-of-scala.html">last blog post</a> I introduced DOT, a minimal calculus that underlies much of Scala. DOT is much more than an academic exercise, because it gives us guidelines on how to design a sound type system for full Scala.</p> 
    <h2><a href="#recap-the-problem-of-bad-bounds" id="recap-the-problem-of-bad-bounds" class="anchor"></a>Recap: The Problem of Bad Bounds</h2> 
    <p>As was argued in the previous blog post, the danger a path-dependent type system like Scala's faces is inconsistent bounds or aliases. For instance, you might have a type alias</p> 
    <pre><code class="language-scala">type T = String
</code></pre> 
    <p>in scope in some part of the program, but in another part the same type member <code>T</code> is known as</p> 
    <pre><code class="language-scala">type T = Int
</code></pre> 
    <p>If you connect the two parts, you end up allowing assigning a <code>String</code> to an <code>Int</code> and vice versa, which is unsound - it will crash at runtime with a <code>ClassCastException</code>. The problem is that there is no obvious, practical, compile time analysis for DOT or Scala that ensures that all types have good bounds. Types can contain abstract type members with bounds that can be refined elsewhere and several independent refinements might lead together to a bad bound problem. Barring a whole program analysis there is no specific point in the program where we can figure this out straightforwardly.</p> 
    <p>In DOT, the problem is resolved by insisting that every path prefix <code>p</code> of a type <code>p.T</code> is at runtime a concrete value. That way, we only have to check for good bounds when objects are <em>created</em> with <code>new</code>, and that check is easy: When objects are created, we know their class and we can insist that all nested types in that class are aliases or have consistent bounds. So far so good.</p> 
    <h2><a href="#loopholes-caused-by-scaling-up" id="loopholes-caused-by-scaling-up" class="anchor"></a>Loopholes Caused by Scaling Up</h2> 
    <p>But if we want to scale up the DOT result for full Scala, several loopholes open up. These come all down to the fact that the prefix of a type selection might <em>not</em> be a value that's constructed with a <code>new</code> at run time. The loopholes can be classified into three categories:</p> 
    <ol> 
     <li>The prefix value might be lazy, and never instantiated to anything, as in: <pre><code class="language-scala">lazy val p: S = p
... p.T ...
</code></pre> <p>Note that trying to access the lazy value <code>p</code> would result in an infinite loop. But using <code>p</code> in a type does not force its evaluation, so we might never evaluate <code>p</code>. Since <code>p</code> is not initialized with a <code>new</code>, bad bounds for <code>T</code> would go undetected.</p> </li> 
     <li>The prefix value might be initialized to <code>null</code>, as in <pre><code class="language-scala">val p: S = null
... p.T ...
</code></pre> <p>The problem here is similar to the first one. <code>p</code> is not initialized with a <code>new</code> so we know nothing about the bounds of <code>T</code>.</p> </li> 
     <li>The prefix might be a type <code>T</code> in a type projection <code>T # A</code>, where <code>T</code> is not associated with a runtime value.</li> 
    </ol> 
    <p>We can in fact construct soundness issues in all of these cases. Look at the discussion for issues <a href="https://github.com/lampepfl/dotty/issues/50">#50</a> and <a href="https://github.com/lampepfl/dotty/issues/1050">#1050</a> in the <a href="https://github.com/lampepfl/dotty/issues/1050">Dotty</a> repository on GitHub. All issues work fundamentally in the same way: Construct a type <code>S</code> which has a type member <code>T</code> with bad bounds, say:</p> 
    <pre><code class="language-scala">Any &lt;: T &lt;: Nothing
</code></pre> 
    <p>Then, use the left subtyping to turn an expression of type <code>Any</code> into an expression of type <code>T</code> and use the right subtyping to turn that expression into an expression of type <code>Nothing</code>:</p> 
    <pre><code class="language-scala">def f(x: Any): p.T = x
def g(x: p.T): Nothing = x
</code></pre> 
    <p>Taken together, <code>g(f(x))</code> will convert every expression into an expression of type <code>Nothing</code>. Since <code>Nothing</code> is a subtype of every other type, this means you can convert an arbitrary expression to have any type you choose. Such a feat is an impossible promise, of course. The promise is usually broken at run-time by failing with a <code>ClassCastException</code>.</p> 
    <h2><a href="#plugging-the-loopholes" id="plugging-the-loopholes" class="anchor"></a>Plugging the Loopholes</h2> 
    <p>To get back to soundness we need to plug the loopholes. Some of the necessary measures are taken in pull request <a href="https://github.com/lampepfl/dotty/issues/1051">#1051</a>. That pull request</p> 
    <ul> 
     <li>tightens the rules for overrides of lazy values: lazy values cannot override or implement non-lazy values,</li> 
     <li>tightens the rules which lazy values can appear in paths: they must be final and must have concrete types with known consistent bounds,</li> 
     <li>allows type projections <code>T # A</code> only if <code>T</code> is a concrete type with known consistent bounds.</li> 
    </ul> 
    <p>It looks like this is sufficient to plug soundness problems (1) and (3). To plug (2), we need to make the type system track nullability in more detail than we do it now. Nullability tracking is a nice feature in its own right, but now we have an added incentive for implementing it: it would help to ensure type soundness.</p> 
    <p>There's one sub-case of nullability checking which is much harder to do than the others. An object reference <code>x.f</code> might be <code>null</code> at run time because the field <code>f</code> is not yet initialized. This can lead to a soundness problem, but in a more roundabout way than the other issues we have identified. In fact, Scala guarantees that in a program that runs to completion without aborting, every field will eventually be initialized, so every non-null field will have good bounds. Therefore, the only way an initialized field <code>f</code> could cause a soundness problem is if the program in question would never get to initialize <code>f</code>, either because it goes into an infinite loop or because it aborts with an exception or <code>System.exit</code> call before reaching the initialization point of <code>f</code>. It's a valid question whether type soundness guarantees should extend to this class of "strange" programs. We might want to draw the line here and resort to runtime checks or exclude "strange" programs from any soundness guarantees we can give. The research community has coined the term <a href="http://soundiness.org/">soundiness</a> for this kind of approach and has <a href="http://cacm.acm.org/magazines/2015/2/182650-in-defense-of-soundiness/fulltext">advocated</a> for it.</p> 
    <p>The necessary restrictions on type projection <code>T # A</code> are problematic because they invalidate some idioms in type-level programming. For instance, the cute trick of making Scala's type system Turing complete by having it <a href="https://michid.wordpress.com/2010/01/29/scala-type-level-encoding-of-the-ski-calculus/">simulate SK combinators</a> would no longer work since that one relies on unrestricted type projections. The same holds for some of the encodings of type-level arithmetic.</p> 
    <p>To ease the transition, we will continue for a while to allow unrestricted type projections under a flag, even though they are potentially unsound. In the current Dotty compiler, that flag is a language import <code>-language:Scala2Compat</code>, but it could be something different for other compilers, e.g. <code>-unsafe</code>. Maybe we can find rules that are less restrictive than the ones we have now, and are still sound. But one aspect should be non-negotiable: Any fundamental deviations from the principles laid down by DOT needs to be proven mechanically correct just like DOT was. We have achieved a lot with the DOT proofs, so we should make sure not to back-slide. And if the experience of the past 10 years has taught us one thing, it is that the meta theory of type systems has many more surprises in store than one might think. That's why mechanical proofs are essential.</p> 
    <hr> 
    <footer> 
     <img id="author-img" src="images/martin.jpg"> <span id="author-signature"> Martin Odersky </span> 
    </footer> 
   </main> 
  </div> 
  <script>
  ((window.gitter = {}).chat = {}).options = {
    room: 'lampepfl/dotty'
  };
</script> 
  <script src="https://sidecar.gitter.im/dist/sidecar.v1.js" async defer></script>
 </body>
</html>  </div>
</main><footer><span class="go-to-top-icon"><a href="#container"><span class="icon-vertical_align_top"></span>&nbsp;Back to top</a></span>Generated by&nbsp;<a href="https://github.com/lampepfl/dotty/tree/master/scala3doc"><img src="../../../../images/scala3doc_logo.svg" alt="Scala3doc" class="scala3doc_logo"></img></a></footer></div></div><script type="text/javascript" src="../../../../scripts/pages.js"></script><script type="text/javascript" src="../../../../scripts/main.js"></script></body></html>
